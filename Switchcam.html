<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Record and Switch Camera</title>
  </head>
  <body>
    <div>
      <video
        style="width: 250px; height: 300px; background-color: red"
        autoplay
      ></video>
      <button id="switchButton">Switch</button>
    </div>

    <script>
      const videoEle = document.querySelector("video");
      let front = false;
      let mediaStream = null;
      let recordedChunks = [];

      function startRecording() {
        recordedChunks = [];
        const options = { mimeType: "video/webm; codecs=vp9" };
        mediaRecorder = new MediaRecorder(mediaStream, options);

        mediaRecorder.ondataavailable = (event) => {
          if (event.data.size > 0) {
            recordedChunks.push(event.data);
          }
        };

        mediaRecorder.onstop = () => {
          const blob = new Blob(recordedChunks, { type: "video/webm" });
          const reader = new FileReader();

          reader.onloadend = () => {
            const base64data = reader.result.split(",")[1];
            console.log("Base64 Video:", base64data);
          };

          reader.readAsDataURL(blob);
        };

        mediaRecorder.start();
        setTimeout(pauseRecording, 10000);
      }

      function pauseRecording() {
        mediaRecorder.pause();
        switchCamera();
        setTimeout(resumeRecording, 10000);
      }

      function resumeRecording() {
        mediaRecorder.resume();
        setTimeout(stopRecording, 10000);
      }

      function stopRecording() {
        mediaRecorder.stop();
      }

      function switchCamera() {
        front = !front;
        const facingMode = front ? "user" : "environment";

        if (mediaStream) {
          const tracks = mediaStream.getTracks();
          tracks.forEach((track) => track.stop());
        }

        window.navigator.mediaDevices
          .getUserMedia({ video: { facingMode: facingMode } })
          .then((stream) => {
            mediaStream = stream;
            videoEle.srcObject = stream;
            console.log(stream);
          })
          .catch((error) => {
            console.error("Error accessing media devices:", error);
          });
      }

      const switchButton = document.getElementById("switchButton");
      switchButton.addEventListener("click", () => {
        startRecording();
      });

      switchCamera(); // Initially, get the video stream with the default facing mode (front camera)
    </script>
  </body>
</html>
