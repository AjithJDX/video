<!DOCTYPE html>
<html>
  <head>
    <title>Video Recording Example</title>
  </head>
  <body>
    <video id="video" autoplay></video>
    <button id="recordBtn" onclick="startRecording()">Start Recording</button>
    <button id="pauseBtn" onclick="togglePause()" disabled>Pause</button>
    <button id="switchCameraBtn" onclick="switchCamera()">Switch Camera</button>
    <div id="timer"></div>

    <script>
      let stream;
      let mediaRecorder;
      let chunks = [];
      let isRecording = false;
      let isPaused = false;
      let countdownInterval;
      let totalSeconds = 0;
      let remainingSeconds = 0;
      let currentCamera = 'user'; // 'user' for front camera, 'environment' for rear camera

      const videoElement = document.getElementById('video');
      const recordButton = document.getElementById('recordBtn');
      const pauseButton = document.getElementById('pauseBtn');
      const switchCameraButton = document.getElementById('switchCameraBtn');
      const timerElement = document.getElementById('timer');

      async function startRecording() {
        recordButton.disabled = true;
        switchCameraButton.disabled = true;
        timerElement.textContent = 'Recording...';

        try {
          const mediaStream = await getMediaStream();
          stream = mediaStream;
          videoElement.srcObject = mediaStream;
          mediaRecorder = new MediaRecorder(mediaStream);

          mediaRecorder.addEventListener('dataavailable', (event) => {
            chunks.push(event.data);
          });

          mediaRecorder.addEventListener('stop', () => {
            const blob = new Blob(chunks, { type: 'video/webm' });
            chunks = [];
            videoElement.srcObject = null;
            videoElement.src = URL.createObjectURL(blob);
            videoElement.controls = true;
            recordButton.disabled = false;
            pauseButton.disabled = true;
            switchCameraButton.disabled = false;
            timerElement.textContent = '';
          });

          mediaRecorder.start();
          isRecording = true;
          remainingSeconds = 0;
          countdownInterval = setInterval(() => {
            remainingSeconds++;
            totalSeconds++;
            timerElement.textContent = `Recording... ${remainingSeconds}s`;

            if (remainingSeconds === 10) {
              clearInterval(countdownInterval);
              mediaRecorder.pause();
              isPaused = true;
              pauseButton.disabled = false;
              switchCameraButton.disabled = true;
              timerElement.textContent = 'Recording Paused';
            }
          }, 1000);
        } catch (error) {
          console.error('Error accessing media devices.', error);
        }
      }

      function togglePause() {
        if (isPaused) {
          mediaRecorder.resume();
          isPaused = false;
          pauseButton.textContent = 'Pause';
          remainingSeconds = 10;
          countdownInterval = setInterval(() => {
            remainingSeconds++;
            totalSeconds++;
            timerElement.textContent = `Recording... ${remainingSeconds}s`;

            if (remainingSeconds === 20) {
              clearInterval(countdownInterval);
              mediaRecorder.stop();
              isRecording = false;
              pauseButton.disabled = true;
              switchCameraButton.disabled = false;
              timerElement.textContent = '';
            }
          }, 1000);
        } else {
          mediaRecorder.pause();
          isPaused = true;
          pauseButton.textContent = 'Resume';
          clearInterval(countdownInterval);
          timerElement.textContent = 'Recording Paused';
        }
      }

      async function getMediaStream() {
        const constraints = {
          video: {
            facingMode: currentCamera === 'user' ? 'user' : 'environment',
          },
        };
        try {
          return await navigator.mediaDevices.getUserMedia(constraints);
        } catch (error) {
          console.error('Error accessing media devices.', error);
          throw error;
        }
      }

      async function switchCamera() {
        currentCamera = currentCamera === 'user' ? 'environment' : 'user';
        stream = await getMediaStream();
        videoElement.srcObject = stream;
      }
    </script>
  </body>
</html>
